-- Error case tests for pg_session_jwt

-- Initialize the session
SELECT auth.init();
 init 
------
 
(1 row)

-- Test error: decreasing token ID
DO $$
DECLARE
    -- These are placeholder values that should be replaced with real JWTs at test time
    test_jwt1 TEXT := 'PLACEHOLDER.JWT.VALUE_JTI2';
    test_jwt2 TEXT := 'PLACEHOLDER.JWT.VALUE_JTI1';
BEGIN
    PERFORM auth.jwt_session_init(test_jwt1);
    BEGIN
        PERFORM auth.jwt_session_init(test_jwt2);
        RAISE EXCEPTION 'Expected error did not occur';
    EXCEPTION
        WHEN check_violation THEN
            RAISE NOTICE 'Expected error caught: Token ID must be strictly monotonically increasing';
    END;
END;
$$;
NOTICE:  Expected error caught: Token ID must be strictly monotonically increasing
DO
